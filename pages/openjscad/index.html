<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  
  <meta property="og:image" content="https://wildthinks.org/assets/images/calculus/penrose.jpg">
  

  <link rel="icon" href="http://wildthinks.org/assets/images/favicon.png">

  <title>
    OpenJSCad Demo - wildthinks
    
  </title>

  <meta name="description" content="### OpenJSCAD Examples Smartdown recently added an integration with [OpenJSCAD](https://www.openjscad.org), which is an open source library that enables an e...">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

  <link href='https://fonts.googleapis.com/css?family=Asap:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/blog-kit/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/blog-kit/assets/vendor/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/blog-kit/assets/main.css">
  <link rel="canonical" href="https://wildthinks.org/blog-kit/pages/openjscad/">
  <link rel="alternate" type="application/rss+xml" title="wildthinks" href="/blog-kit/feed.xml">

  
  <link rel=stylesheet href="https://unpkg.com/smartdown/dist/lib/smartdown.css">
<link rel=stylesheet href="https://unpkg.com/smartdown/dist/lib/fonts.css">
<script type="text/javascript" src="https://unpkg.com/smartdown/dist/lib/smartdown.js">
</script>
<script type="text/javascript" src="https://unpkg.com/smartdown/dist/lib/calc_handlers.js"></script>
<script type="text/x-smartdown" id="Home">
### OpenJSCAD Examples

Smartdown recently added an integration with [OpenJSCAD](https://www.openjscad.org), which is an open source library that enables an easy-to-understand OpenJSCAD *program* to be compiled into an interactive 3D model. This is very *bleeding edge* and there are likely going to be some bugs, especially if Dynamic Generation (experimental) is being used.

Smartdown supports OpenJSCAD diagrams as playables, by using the syntax:

````markdown
```openjscad/playable/autoplay
  // OpenJSCAD script here
```
````

Smartdown also supports the use of `openjscad` as an output cell filter, enabling a cell to display a rendered Smartdown variable containing an OpenJSCAD script (see Dynamic Generation at the end of this document).

#### About OpenJSCAD

In order to get the OpenJSCAD UMD library to support multiple diagrams on a web page, I needed to make a few minor fixes to the OpenJSCAD UMD Library. See my fork at [doctorbud/OpenJSCAD.org](https://github.com/DoctorBud/OpenJSCAD.org/tree/reentracy-fixes-for-umd) for the relevant changes.


#### Color and Transparency Example

This examples shows some of the color and transparency potential. Based upon [transparency.jscad](https://github.com/jscad/OpenJSCAD.org/blob/master/packages/examples/transparency.jscad)

```openjscad/playable/autoplay
// title      : Transparency
// author     : Rene K. Mueller
// license    : MIT License
// description: showing transparent objects
// file       : transparency.jscad

function main () {
  var o = [];
  for (var i = 7; i >= 0; i--) { // reverse order for seeing through all cylinders (see https://www.opengl.org/wiki/Transparency_Sorting)
    // hsl to rgb, creating rainbow [r,g,b]
    o.push(
      cylinder({r: 3, h: 20}).setColor(
        hsl2rgb(i / 8, 1, 0.5).concat(1 / 8 + i / 8) // and add to alpha to make it [r,g,b,a]
      ).translate([(i - 3) * 7.5, 0, 0])
    );
  }
  o.push(color('red', cube(5)).translate([-4, -10, 0]));
  o.push(color('red', 0.5, cube(5)).translate([4, -10, 0]));
  return o;
}
```


#### Gear Example

This example illustrates a parameterizable model of a gear. OpenJSCAD provides a mechanism to allow the author to specify that certain *parameters* can be controlled by the user. This is based upon the original at [gear.jscad](https://github.com/jscad/OpenJSCAD.org/blob/master/packages/examples/gear.jscad).

```openjscad/playable/autoplay

// title      : Gear
// author     : Joost Nieuwenhuijse
// license    : MIT License
// description: a simple gear
// file       : gear.jscad

// Here we define the user editable parameters:
function getParameterDefinitions () {
  return [
    { name: 'numTeeth', caption: 'Number of teeth:', type: 'int', initial: 10, min: 5, max: 20, step: 1 },
    { name: 'circularPitch', caption: 'Circular pitch:', type: 'float', initial: 5 },
    { name: 'pressureAngle', caption: 'Pressure angle:', type: 'float', initial: 20 },
    { name: 'clearance', caption: 'Clearance:', type: 'float', initial: 0.0, step: 0.1 },
    { name: 'thickness', caption: 'Thickness:', type: 'float', initial: 5 },
    { name: 'centerholeradius', caption: 'Radius of center hole (0 for no hole):', type: 'float', initial: 2 }
  ];
}

// Main entry point; here we construct our solid:
function main (params) {
  var gear = involuteGear(
    params.numTeeth,
    params.circularPitch,
    params.pressureAngle,
    params.clearance,
    params.thickness
  );
  if (params.centerholeradius > 0) {
    var centerhole = CSG.cylinder({start: [0, 0, -params.thickness], end: [0, 0, params.thickness], radius: params.centerholeradius, resolution: 16});
    gear = gear.subtract(centerhole);
  }
  return gear;
}

/*
  For gear terminology see:
    https://www.astronomiainumbria.org/advanced_internet_files/meccanica/easyweb.easynet.co.uk/_chrish/geardata.htm
  Algorithm based on:
    https://www.cartertools.com/involute.html

  circularPitch: The distance between adjacent teeth measured at the pitch circle
*/
function involuteGear (numTeeth, circularPitch, pressureAngle, clearance, thickness) {
  // default values:
  if (arguments.length < 3) pressureAngle = 20;
  if (arguments.length < 4) clearance = 0;
  if (arguments.length < 4) thickness = 1;

  var addendum = circularPitch / Math.PI;
  var dedendum = addendum + clearance;

  // radiuses of the 4 circles:
  var pitchRadius = numTeeth * circularPitch / (2 * Math.PI);
  var baseRadius = pitchRadius * Math.cos(Math.PI * pressureAngle / 180);
  var outerRadius = pitchRadius + addendum;
  var rootRadius = pitchRadius - dedendum;

  var maxtanlength = Math.sqrt(outerRadius * outerRadius - baseRadius * baseRadius);
  var maxangle = maxtanlength / baseRadius;

  var tlAtPitchCircle = Math.sqrt(pitchRadius * pitchRadius - baseRadius * baseRadius);
  var angleAtPitchCircle = tlAtPitchCircle / baseRadius;
  var diffangle = angleAtPitchCircle - Math.atan(angleAtPitchCircle);
  var angularToothWidthAtBase = Math.PI / numTeeth + 2 * diffangle;

  // build a single 2d tooth in the 'points' array:
  var resolution = 5;
  var points = [new CSG.Vector2D(0, 0)];
  for (var i = 0; i <= resolution; i++) {
    // first side of the tooth:
    var angle = maxangle * i / resolution;
    var tanlength = angle * baseRadius;
    var radvector = CSG.Vector2D.fromAngle(angle);
    var tanvector = radvector.normal();
    var p = radvector.times(baseRadius).plus(tanvector.times(tanlength));
    points[i + 1] = p;

    // opposite side of the tooth:
    radvector = CSG.Vector2D.fromAngle(angularToothWidthAtBase - angle);
    tanvector = radvector.normal().negated();
    p = radvector.times(baseRadius).plus(tanvector.times(tanlength));
    points[2 * resolution + 2 - i] = p;
  }

  // create the polygon and extrude into 3D:
  var tooth3d = new CSG.Polygon2D(points).extrude({offset: [0, 0, thickness]});

  var allteeth = new CSG();
  for (var j = 0; j < numTeeth; j++) {
    var ang = j * 360 / numTeeth;
    var rotatedtooth = tooth3d.rotateZ(ang);
    allteeth = allteeth.unionForNonIntersecting(rotatedtooth);
  }

  // build the root circle:
  points = [];
  var toothAngle = 2 * Math.PI / numTeeth;
  var toothCenterAngle = 0.5 * angularToothWidthAtBase;
  for (var k = 0; k < numTeeth; k++) {
    var angl = toothCenterAngle + k * toothAngle;
    var p1 = CSG.Vector2D.fromAngle(angl).times(rootRadius);
    points.push(p1);
  }

  // create the polygon and extrude into 3D:
  var rootcircle = new CSG.Polygon2D(points).extrude({offset: [0, 0, thickness]});

  var result = rootcircle.union(allteeth);

  // center at origin:
  result = result.translate([0, 0, -thickness / 2]);

  return result;
}

```


#### Text Example

Based upon [text.jscad](https://github.com/jscad/OpenJSCAD.org/blob/master/packages/examples/text.jscad), this example illustrates OpenJSCAD's parameter mechanism, and also the ability to render 3D text.

```openjscad/playable/autoplay

// title      : Vector Text Rendering
// author     : Rene K. Mueller
// license    : MIT License
// description: playing with vector font
// date       : 2013/04/22
// file       : text.jscad

function getParameterDefinitions () {
  return [
    { name: 's', initial: 'Hello World!', type: 'text', caption: 'Text to render', size: 30 },
    { name: 'c', initial: 'A', type: 'text', caption: 'Char to render', size: 2 }
  ];
}

function main (param) {
  var o = [];

  var l = vector_text(0, 0, param.s); // get line segments [ [ [x1,y1], [x2,y2] ...], [ ]... ]

  l.forEach(function (s) { // process the line segments
    o.push(rectangular_extrude(s, {w: 2, h: 2}));
  });

  if (param.c.length) {
    var c = vector_char(0, 0, param.c); // get data for one character
    var a = c.segments;
    for (var i = 0; i < 5; i++) {
      var p = [];
      a.forEach(function (s) {
        p.push(circularExtrude(s, {r: i / 2 + 1, fn: 8})); // variable thickness
      });
      o.push(union(p).setColor(hsl2rgb(i / 5, 1, 0.5)).translate([i * (c.width + i / 2), 30, 0]));
    }
  }
  return union(o).scale(0.5).translate([-50, 0, 0]);
}

// -- simplistic circularExtrude done with cylinders + spheres

function circularExtrude (s, p) {
  var o = [];
  var r = 1; fn = 16; rot = 0;
  if (p) {
    if (p.r) r = p.r;
    if (p.fn) fn = p.fn;
    if (p.rot !== undefined) rot = p.rot;
  }
  for (var i = 0; i < s.length - 1; i++) {
    var p1 = s[i].concat(0);
    var p2 = s[i + 1].concat(0);
    o.push(cylinder({start: p1, end: p2, r: r, fn: fn}));
    o.push(sphere({center: true, r: r, fn: fn}).translate(p1));
    if (i === s.length - 2) {
      o.push(sphere({center: true, r: r, fn: fn}).translate(p2));
    }
  }
  return union(o);
}
```

#### Name Plate Example

From the [name_plate.jscad](https://github.com/jscad/OpenJSCAD.org/blob/master/packages/examples/name_plate.jscad) example.

```openjscad/playable/autoplay

const jscad = require('@jscad/modeling')
const { translate, scale, rotateZ } = jscad.transforms
const { union } = jscad.booleans

// Load the STL files using require
const sculpture = require('./3d_sculpture-VernonBussler.stl')
const frog = require('./frog-OwenCollins.stl')

const fox = ''
const main = () => {
  return union(
    fox
  )
}

module.exports = { main }

```


#### Dynamic Generation

One of Smartdown's powers (which hasn't been fully generalized yet) is the ability to generate Smartdown text that will be rendered and interpreted. This same power has been implemented for `Graphviz`, and just recently, for `openjscad`. So we can treat Smartdown, OpenJSCad, and Graphviz as *output formats* and have their contents rendered into an appropriate Smartdown cell.

So let's write a little playable that generates an OpenJSCAD script, and have that script rendered into a cell. To make it more fun, let's have the playable react to an ordinary Smartdown cell. In this case, we'll just have the cell generate some 3D text.

[Text](:?Text)



#### Smartdown Logo via OpenJSCAD

I'd like to build a 3D model of the [Smartdown Logo](https://doctorbud.com/celestial-toys/post/2018-11-23-logo-version-2/#index):

![](/gallery/resources/logo.svg)


But so far I've only built a very rough starting point:


```openjscad/playable/autoplay

function main () {
  const height = 30.0;

  var sqrt3 = Math.sqrt(3);

  const v0 = {
          x: sqrt3 * height / 4.0,
          y: 0
        };
  const v1 = {
          x: sqrt3 * height / 2.0,
          y: height / 4.0
        };
  const v2 = {
          x: sqrt3 * height / 2.0,
          y: 3 * height / 4.0
        };
  const v3 = {
          x: sqrt3 * height / 4.0,
          y: height
        };
  const v4 = {
          x: 0,
          y: 3 * height / 4.0
        };
  const v5 = {
          x: 0,
          y: height / 4.0
        };

  const width = v1.x;
  const center = {
    x: (v1.x - v5.x) / 2.0,
    y: (v3.y - v0.y) / 2.0,
  };

  const hexagon = polyhedron({
    points: [
      [v0.x, v0.y, 5.0],
      [v1.x, v1.y, 5.0],
      [v2.x, v2.y, 5.0],
      [v3.x, v3.y, 5.0],
      [v4.x, v4.y, 5.0],
      [v5.x, v5.y, 5.0],
    ],
    triangles: [
      [1, 0, 5],
      [2, 1, 0],
      [3, 2, 1],
      [4, 3, 2],
      [5, 4, 3],
      [0, 5, 4],
      [5, 0, 1],
      [0, 1, 2],
      [1, 2, 3],
      [2, 3, 4],
      [3, 4, 5],
      [4, 5, 0],
    ]
  }).setColor(css2rgb('chartreuse'));

  const pyramid = polyhedron({
    points: [ [5,5,0],[5,-5,0],[-5,-5,0],[-5,5,0], // the four points at base
              [0,0,10] ],                                  // the apex point
    triangles: [ [0,1,4],[1,2,4],[2,3,4],[3,0,4],          // each triangle side
                 [1,0,3],[2,1,3] ]                         // two triangles for square base
  }).setColor(css2rgb('tomato'));

  return union([pyramid, hexagon]);
}
```

---

The source for this page is visible at the Smartdown Gallery at [OpenJSCAD](/gallery/OpenJSCAD.md).

---

[Back to Home](:@Home)


</script>

  

  
</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/blog-kit/">  
      <img src="/blog-kit/assets/images/wildthinksLogo.svg" height="30">
    </a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      
      <ul class="noheadernav navbar-nav ml-auto">
      
        <li class="nav-item">
          <a class="nav-link" href="/blog-kit/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog-kit/pages/About/">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog-kit/posts">Blog</a>
        </li>
      </ul>
    </div>
  </div>
</nav>



  <!-- Page Header -->

<header id="header-wrapper" class="masthead noheader">
</header>  
  



  <div class="container-fluid smartdown-outer-container smartdown-theme">
    <div class="row">
      <div class="col-xs-12 smartdown-container" id="blog-content">
      <!-- <div class="col-lg-8 col-md-10 mx-auto smartdown-container" id="blog-content"> -->
      </div>
    </div>
  </div>



  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:goldfishandrobin@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/wildthinksLab">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/wildthinkslaboratory">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; Heidi Dixon 2022</p>
      </div>
    </div>
  </div>
</footer>


  <script src="/blog-kit/assets/vendor/jquery/jquery.min.js"></script>
<script src="/blog-kit/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/blog-kit/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/blog-kit/assets/scripts.js"></script>




  
  <script>
  /* global smartdown */
  var baseURL = '/blog-kit/';
  var icons = {
    'rectangle' : `/assets/images/calculus/rectangle.svg`,
    'secant' : `/assets/images/calculus/secant.svg`,
    'ftc1' : `/assets/images/calculus/ftc1.svg`,
    'usamts2' : `/assets/images/calculus/usamts2.svg`,
    'usamts1' : `/assets/images/calculus/usamts1.svg`,
    'negaBinary' : `/assets/images/calculus/negaBinary.svg`,
    'string' : `/assets/images/calculus/strings.svg`,
    'derivative' : `/assets/images/calculus/derivative.svg`,
    'chainrule' : `/assets/images/calculus/chainrule.svg`,
    'fractal' : `/assets/images/calculus/fractal.svg`,
    'limits'  : `/assets/images/calculus/limits.svg`,
    'eToTheX' : `/assets/images/calculus/eToTheX.svg`,
    'ftc2' : `/assets/images/calculus/ftc2.svg`,
    'epsilonDelta': `/assets/images/calculus/epsilonDelta.svg`,
    'penrose' : `/assets/images/calculus/penrose.svg`,
    'circles' : `/assets/images/calculus/circles.svg`,
    'GR' : `/assets/images/calculus/GR.svg`,
    'Fib' : `/assets/images/calculus/FibDots.svg`,
    '2Ddots' : `/assets/images/calculus/2Ddots.svg`,
    'circCoord' : `/assets/images/calculus/circCoord.svg`,
    'spiral1' : `/assets/images/calculus/spiral1.svg`
  };

  var multiparts = null;
  var current = null;


  function cardLoaded(url, cardKeySubhash, sourceText) {
    /* eslint no-invalid-this: 0 */
    sourceText = sourceText.trim();
    multiparts = smartdown.partitionMultipart(sourceText);

    if (url.endsWith('.md')) {
      const newPath = url.replace(/\.md$/, '/');
      current = newPath;
      history.pushState(null, null, newPath);
    }

    var output = document.getElementById('blog-content');
    smartdown.setHome(multiparts._default_, output, function() {
      document.body.scrollTop = 0; // For Chrome, Safari and Opera
      document.documentElement.scrollTop = 0; // For IE and Firefox

      if (cardKeySubhash) {
        const target = document.getElementById(cardKeySubhash);
        if (target) {
          target.scrollIntoView();
        }
      }

      smartdown.startAutoplay(output);
    });
  }

  function loadURL(url) {
    var oReq = new XMLHttpRequest();
    let cardKeySubhash = null;
    const hashPos = url.indexOf('#');
    if (hashPos >= 0) {
      cardKeySubhash = url.slice(hashPos + 1);
    }

    oReq.addEventListener('load', function() {
      cardLoaded(url, cardKeySubhash, this.responseText);
    });
    oReq.open('GET', url);
    oReq.send();
  }

  function loadInline() {
    smartdown.loadCardsFromDocumentScripts();
    var s = smartdown.smartdownScripts[0];

    cardLoaded(window.location.href, window.location.hash.slice(1), s.text);
  }

  function cardLoader(cardKey) {
    // console.log('cardLoader', cardKey);
    var part = multiparts[cardKey];
    if (part) {
      var output = document.getElementById('blog-content');
      smartdown.setHome(part, output, function() {
        smartdown.startAutoplay(output);
      });
    }
    else {
      var cardURL = cardKey;
      if (cardKey.indexOf('http') === 0) {
        cardURL = cardKey;
      }
      else {
        const expanded = smartdown.expandHrefWithLinkRules(cardURL);
        // console.log('cardloader', cardURL, expanded);
        cardURL = expanded;
      }
      // else if (cardKey.indexOf('/posts') === 0) {
      //   cardURL = `${baseURL}${cardKey}`;
      //   console.log('cardLoader', cardKey, cardURL);
      // }
      loadURL(cardURL);
    }
  }

  var calcHandlers = smartdown.defaultCalcHandlers;
  const linkRules = [
    {
      prefix: '/posts/',
      replace: baseURL + '/posts/',
    },
    {
      prefix: '/pages/',
      replace: baseURL + '/pages/',
    },
    {
      prefix: '/assets/',
      replace: baseURL + '/assets/',
    },
  ];



  window.addEventListener(
    'popstate',
    function(event) {
      const url = document.location.pathname;
      if (url.endsWith('/')) {
        const newPath = url.replace(/\/$/, '.md');
        // console.log('popstatex: ', url, newPath, current, window.location.hash);
        if (current && url !== current) {
          loadURL(newPath);
        }
      }
    },
    false);
  // window.addEventListener(
  //   'hashchange',
  //   function(event) {
  //     console.log(
  //       'hashchange document.location.pathname: ' + document.location.pathname,
  //       JSON.stringify(event.state));
  //   },
  //   false);

  smartdown.initialize(icons, `https://unpkg.com/smartdown/dist/`, loadInline, cardLoader, calcHandlers, linkRules);
</script>

  

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXXX-X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-XXXXXXXXX-X');
</script>



</body>

</html>
